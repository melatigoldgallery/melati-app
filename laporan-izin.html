<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Tangerine:wght@400;700&display=swap" rel="stylesheet" />
    <!-- jQuery first -->
    <script src="js/jquery-3.6.3.min.js"></script>
    <!-- Bootstrap CSS and JS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- SheetJS (Excel Export) -->
    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
    <!-- jsPDF (PDF Export) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <!-- Your custom CSS -->
    <link rel="stylesheet" href="css/Project1.css" />
    <link rel="stylesheet" href="css/absensi.css"/>  
    <title>Laporan Izin Bulanan - Melati Gold Shop</title>
    <style>
        .report-controls {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .status-approved {
            color: #28a745;
            font-weight: bold;
        }
        .status-rejected {
            color: #dc3545;
            font-weight: bold;
        }
        .status-pending {
            color: #ffc107;
            font-weight: bold;
        }
        .status-sudah-diganti {
            color: #28a745;
        }
        .status-belum-diganti {
            color: #6c757d;
        }
        .export-btn {
            margin-right: 10px;
        }
        .delete-btn {
            background-color: #dc3545;
            color: white;
        }
        .month-selector {
            max-width: 200px;
        }
        .year-selector {
            max-width: 120px;
        }
        #leaveReportTable {
            width: 100%;
            border-collapse: collapse;
        }
        #leaveReportTable th, #leaveReportTable td {
            padding: 10px;
            border: 1px solid #dee2e6;
        }
        #leaveReportTable th {
            background-color: #f8f9fa;
            position: sticky;
            top: 0;
        }
        .table-container {
            max-height: 500px;
            overflow-y: auto;
            margin-bottom: 20px;
        }
        .summary-card {
            margin-bottom: 20px;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        }
        .summary-value {
            font-size: 24px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <div class="nav-brand">
                <a href="#">
                    <img src="img/Melati.jfif" alt="Logo" />
                    <span class="tangerine-bold">Melati Gold Shop</span>
                </a>
            </div>
            <div class="nav-list align-items-center mt-3">
                <ul class="d-flex justify-content-center gap-3">
                    <li class="dropdown">
                        <a class="text-decoration-none text-dark dropdown-toggle" href="#" id="documentationLink" data-bs-toggle="dropdown">
                            <i class="fa-solid fa-users"></i> Pengajuan Staff <i class="fa-solid fa-chevron-down"></i>
                        </a>
                        <div class="dropdown-menu">
                            <a class="dropdown-item" href="sistemAbsensi.html">
                                <i class="fa-solid fa-file-contract"></i> Kehadiran
                            </a>
                            <a class="dropdown-item" href="pengajuan.html">
                                <i class="fa-solid fa-file-contract"></i> Pengajuan Izin
                            </a>
                            <a class="dropdown-item" href="supervisor.html">
                                <i class="fa-solid fa-calendar-days"></i> Status Pengajuan
                            </a>
                        </div>
                    </li>
                    <li class="dropdown">
                        <a class="text-decoration-none text-dark dropdown-toggle" href="#" id="documentationLink" data-bs-toggle="dropdown">
                            <i class="fa-solid fa-gear"></i> Pengaturan <i class="fa-solid fa-chevron-down ms-1"></i>
                        </a>
                        <div class="dropdown-menu">
                            <a class="dropdown-item" href="pengguna.html">
                                <i class="fa-solid fa-file-contract"></i> Tambah User 
                            </a>
                        </div>
                    </li>
                    <li class="dropdown">
                        <a class="text-decoration-none text-dark dropdown-toggle" href="#" id="documentationLink" data-bs-toggle="dropdown">
                            <i class="fa-solid fa-file-lines"></i> Laporan <i class="fa-solid fa-chevron-down ms-1"></i>
                        </a>
                        <div class="dropdown-menu">
                            <a class="dropdown-item" href="laporan-kehadiran.html">
                                <i class="fa-solid fa-file-contract"></i> Laporan Kehadiran
                            </a>
                            <a class="dropdown-item" href="laporan-izin.html">
                                <i class="fa-solid fa-file-contract"></i> Laporan Izin
                            </a>
                        </div>
                    </li>
                </ul>
            </div>
            <div class="left-nav">
                <div class="hamburger-menu">
                    <i class="fas fa-bars"></i>
                </div>
                <div class="date">
                    <span id="clock" class="font-weight-bold"></span>
                    <br />
                    <span id="tgl" class="font-weight-bold"></span>
                </div>
                <div class="dropdown">
                    <button class="btn btn-secondary dropdown-toggle akun" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                        K
                    </button>
                    <ul class="dropdown-menu">
                        <li>
                            <button class="btn btn-lg" id="logoutBtn" onclick="handleLogout()">Logout</button>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>
    <main>
        <div class="mainbar">
            <div class="maintop">
                <p><i class="fas fa-file-alt me-2"></i> Laporan Izin Bulanan</p>
            </div>
            <div class="container">
                <!-- Alert for feedback -->
                <div id="alertContainer" class="mb-3" style="display: none;"></div>
                
                <!-- Report Controls -->
                <div class="report-controls">
                    <div class="row align-items-end">
                        <div class="col-md-3">
                            <label for="monthSelector" class="form-label">Bulan</label>
                            <select id="monthSelector" class="form-select month-selector">
                                <option value="1">Januari</option>
                                <option value="2">Februari</option>
                                <option value="3">Maret</option>
                                <option value="4">April</option>
                                <option value="5">Mei</option>
                                <option value="6">Juni</option>
                                <option value="7">Juli</option>
                                <option value="8">Agustus</option>
                                <option value="9">September</option>
                                <option value="10">Oktober</option>
                                <option value="11">November</option>
                                <option value="12">Desember</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label for="yearSelector" class="form-label">Tahun</label>
                            <select id="yearSelector" class="form-select year-selector">
                                <!-- Will be populated with JavaScript -->
                            </select>
                        </div>
                        <div class="col-md-6 d-flex justify-content-end">
                            <button id="generateReportBtn" class="btn btn-primary">
                                <i class="fas fa-sync-alt me-2"></i> Generate Laporan
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Summary Cards -->
                <div class="row mb-4" id="summaryCards" style="display: none;">
                    <div class="col-md-3">
                        <div class="card summary-card bg-light">
                            <div class="card-body text-center">
                                <h6 class="card-title text-muted">Total Izin</h6>
                                <p class="summary-value" id="totalLeaves">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card summary-card bg-success bg-opacity-10">
                            <div class="card-body text-center">
                                <h6 class="card-title text-muted">Disetujui</h6>
                                <p class="summary-value text-success" id="approvedLeaves">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card summary-card bg-danger bg-opacity-10">
                            <div class="card-body text-center">
                                <h6 class="card-title text-muted">Ditolak</h6>
                                <p class="summary-value text-danger" id="rejectedLeaves">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card summary-card bg-warning bg-opacity-10">
                            <div class="card-body text-center">
                                <h6 class="card-title text-muted">Pending</h6>
                                <p class="summary-value text-warning" id="pendingLeaves">0</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Export & Delete Buttons -->
                <div class="d-flex justify-content-between mb-3" id="actionButtons" style="display: none !important;">
                    <div>
                        <button id="exportExcelBtn" class="btn btn-success export-btn">
                            <i class="fas fa-file-excel me-2"></i> Export Excel
                        </button>
                        <button id="exportPdfBtn" class="btn btn-danger export-btn">
                            <i class="fas fa-file-pdf me-2"></i> Export PDF
                        </button>
                    </div>
                    <button id="deleteDataBtn" class="btn delete-btn">
                        <i class="fas fa-trash-alt me-2"></i> Hapus Data Bulan Ini
                    </button>
                </div>
                
                <!-- Table Container -->
                <div class="table-container" id="tableContainer" style="display: none;">
                    <table id="leaveReportTable">
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>ID Staff</th>
                                <th>Nama</th>
                                <th>Tanggal Pengajuan</th>
                                <th>Tanggal Izin</th>
                                <th>Alasan</th>
                                <th>Jenis Pengganti</th>
                                <th>Detail Pengganti</th>
                                <th>Status</th>
                                <th>Tanggal Keputusan</th>
                                <th>Status Ganti</th>
                            </tr>
                        </thead>
                        <tbody id="leaveReportList"></tbody>
                    </table>
                </div>
                
                                <!-- No Data Message -->
                                <div id="noDataMessage" class="alert alert-info text-center" style="display: none;">
                                    <i class="fas fa-info-circle me-2"></i>
                                    Tidak ada data izin untuk periode yang dipilih
                                </div>
                            </div>
                        </div>
                        <aside class="sidebar">
                            <ul>
                                <li>
                                    <a href="dashboard.html" class="dashboard">Dashboard</a>
                                </li>
                                <li>
                                    <a href="admin.html" class="inpt-btn" data-target="inpt-show">Antrian</a>
                                </li>
                                <li>
                                    <a href="buyback.html" class="sell-btn" data-target="sell-show">Buyback</a>
                                </li>
                                <li>
                                    <a href="sistemAbsensi.html" class="utlt-btn" data-target="utlt-show">Absensi</a>
                                </li>
                                <li>
                                    <a href="#" class="lprn-btn" data-target="lprn-show">
                                        Laporan<span class="fas fa-caret-down third"></span>
                                    </a>
                                    <ul class="lprn-show" id="lprn-show">
                                        <li><a href="analisis.html">Analisis Antrian</a></li>
                                        <li><a href="laporan-kehadiran.html">Laporan Kehadiran</a></li>
                                        <li><a href="laporan-izin.html">Laporan Izin</a></li>
                                    </ul>
                                </li>
                            </ul>
                        </aside>
                    </main>
                
                    <!-- Confirmation Modal for Delete -->
                    <div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteConfirmModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header bg-danger text-white">
                                    <h5 class="modal-title" id="deleteConfirmModalLabel">Konfirmasi Hapus Data</h5>
                                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <div class="alert alert-warning">
                                        <i class="fas fa-exclamation-triangle me-2"></i>
                                        <strong>Perhatian!</strong> Tindakan ini tidak dapat dibatalkan.
                                    </div>
                                    <p>Anda yakin ingin menghapus semua data izin untuk bulan <span id="deleteMonthName" class="fw-bold"></span> <span id="deleteYear" class="fw-bold"></span>?</p>
                                    <p>Data yang dihapus tidak dapat dikembalikan. Pastikan Anda telah mengekspor data sebelum menghapusnya.</p>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn">
                                        <i class="fas fa-trash-alt me-2"></i> Ya, Hapus Data
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                
                    <script type="module" src="js/melati.js"></script>
                    <script type="module" src="js/laporan-izin.js"></script>
                </body>
                </html>
                
